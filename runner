#!/bin/bash

# set up concurrency
if [[ -f "/etc/gitlab-runner/config.toml" ]]; then
  sed -i -e "/concurrent/d" "/etc/gitlab-runner/config.toml"
fi

echo "concurrent=${CONCURRENT:-1}" >> /etc/gitlab-runner/config.toml

# register gitlab-runner
gitlab-runner register

# present current config
cat /etc/gitlab-runner/config.toml

# launch gitlab-runner passing all arguments
gitlab-runner run --working-directory /home/gitlab-runner
